---
title: 项目难点笔记本
date: 2018-08-10 13:40:58
tags:
---
### h264解码

在做h264解码的过程，一开始是想利用broadway.js这个项目，让后台通过websocket将h264数据一帧一帧地传给我们，我们来完成前端解码的工作，但是因为该项目文档并不是很清楚，所以我们解码一直没成功，也没有报错，所以我们转战其它类似的项目，h264bsd是一个基于broadway.js的一个项目，但它的文档相对比较清楚，也有例子，我们就再试了一下，这时试的是一整个h264的文件，而不是一帧帧的数据，而且，后台也提供了两个压缩率不同的h264文件，这次终于解码成功了，压缩率为baseline类型的成功了，压缩率为high的同样没有解码成功，于是我们终于找到问题的所在，压缩率这个问题导致解码器一直没有解码成功

这里的压缩率其实是指压缩过程i帧的比例,baseline的i帧比较多，high压缩的p帧比较多

H264压缩技术主要采用了以下几种方法对视频数据进行压缩。包括：

帧内预测压缩，解决的是空域数据冗余问题。
帧间预测压缩（运动估计与补偿），解决的是时域数据冗徐问题。
整数离散余弦变换（DCT），将空间上的相关性变为频域上无关的数据然后进行量化。
CABAC压缩。

经过压缩后的帧分为：I帧，P帧和B帧:
I帧：关键帧，采用帧内压缩技术。
P帧：向前参考帧，在压缩时，只参考前面已经处理的帧。采用帧音压缩技术。
B帧：双向参考帧，在压缩时，它即参考前而的帧，又参考它后面的帧。采用帧间压缩技术

还有一种常见的压缩，JPEG压缩，JPEG的有损压缩，损的是量化过程中的高频部分


### 不同分辨率canvas的处理问题

通过css设定宽高解决


### 创建一个空文件并转成File格式上传到服务器
- 通过fs.openSync创建一个空的文件
- 通过fs.readFile读取文件内容
- 将读取到的文件内容传给一个Blob对象
- 将Blob对象转成File格式
```
function getUploadFile(filePath) {
    fs.openSync(filePath, 'w')
    
    let file = fs.readFileSync(filePath)
    
    let b = new Blob([file], {type: 'application/octet-stream'})
    let emptyFile = new File([b], filename)

    #可以上传的File对象
    return emptyFile  
}
```